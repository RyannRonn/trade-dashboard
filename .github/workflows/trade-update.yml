# .github/workflows/trade-update.yml
# ê´€ì„¸ì²­ ìˆ˜ì¶œì… ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ (ë§¤ì›” 15ì¼ ì˜¤ì „ 9ì‹œ KST)
#
# ì„¤ì • ë°©ë²•:
# 1. GitHub repo Settings â†’ Secrets â†’ New repository secret
#    Name: DATA_GO_KR_API_KEY
#    Value: ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤
#
# 2. ì´ íŒŒì¼ì„ .github/workflows/ ì— ì €ì¥
# 3. ë! ë§¤ì›” 15ì¼ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

name: ğŸ“Š ìˆ˜ì¶œì… ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸

on:
  schedule:
    # ë§¤ì›” 15ì¼ ì˜¤ì „ 9ì‹œ KST (= UTC 00:00)
    - cron: '0 0 15 * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: pip install -r requirements.txt

    - name: ğŸ“¡ ë°ì´í„° ìˆ˜ì§‘ & HTML ìƒì„±
      env:
        API_KEY: ${{ secrets.DATA_GO_KR_API_KEY }}
      run: python customs_trade_v2.py

    - name: ğŸ—„ï¸ DB ë™ê¸°í™”
      run: python -m collector.migrate_json

    - name: ğŸš€ Commit & Push
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add trade.html trade_data_v2.json trade.db
        git diff --staged --quiet || git commit -m "ğŸ“Š ìˆ˜ì¶œì… ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ $(date +'%Y-%m-%d %H:%M')"
        git push
